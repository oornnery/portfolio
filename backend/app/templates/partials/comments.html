<div class="fade-in">
    <h3>Comments ({{ comments|length }})</h3>
    
    <!-- Comment Form -->
    <div class="mb-2" style="background-color: var(--current-line); padding: 1.5rem; border-radius: 8px;">
        {% if user %}
        <form hx-post="/comments/post/{{ post.slug }}" hx-target="#comments" hx-swap="outerHTML">
            <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                {% if user.avatar_url %}
                <img src="{{ user.avatar_url }}" alt="{{ user.name }}" style="width: 40px; height: 40px; border-radius: 50%;">
                {% endif %}
                <div style="flex-grow: 1;">
                    <textarea name="content" rows="3" placeholder="Write a comment..." required style="width: 100%; padding: 10px; border-radius: 4px; border: 1px solid var(--comment); background-color: var(--bg-color); color: var(--fg-color);"></textarea>
                </div>
            </div>
            <div style="text-align: right;">
                <button type="submit" class="btn btn-primary">Post Comment</button>
            </div>
        </form>
        {% else %}
        <div class="text-center">
            <p class="mb-1">Please login to leave a comment.</p>
            <a href="/api/auth/login/github" class="btn btn-outline">Login with GitHub</a>
        </div>
        {% endif %}
    </div>

    <!-- Comments List -->
    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
        {% for comment in comments %}
        <div style="background-color: var(--current-line); padding: 1.5rem; border-radius: 8px;">
            <div style="display: flex; gap: 1rem; margin-bottom: 0.5rem;">
                {% if comment.user_avatar %}
                <img src="{{ comment.user_avatar }}" alt="{{ comment.user_name }}" style="width: 40px; height: 40px; border-radius: 50%;">
                {% else %}
                <div style="width: 40px; height: 40px; border-radius: 50%; background-color: var(--purple); display: flex; align-items: center; justify-content: center; font-weight: bold;">
                    {{ comment.user_name[:1] }}
                </div>
                {% endif %}
                <div>
                    <div style="font-weight: bold; color: var(--purple);">{{ comment.user_name }}</div>
                    <div style="font-size: 0.8rem; color: var(--comment);">{{ comment.created_at.strftime('%b %d, %Y at %H:%M') }}</div>
                </div>
            </div>
            <div style="color: var(--fg-color);">
                {{ comment.content }}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
