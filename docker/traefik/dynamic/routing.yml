http:
  routers:
    portfolio-analytics:
      entryPoints:
        - web
      rule: Path(`/api/v1/analytics/track`) && Method(`POST`)
      priority: 100
      service: portfolio-app
      middlewares:
        - portfolio-rate-limit-global
        - portfolio-inflight-global
        - portfolio-body-limit-analytics
        - portfolio-analytics-rate-limit
        - portfolio-compress
        - portfolio-analytics-allow

    portfolio-contact:
      entryPoints:
        - web
      rule: Path(`/contact`) && Method(`POST`)
      priority: 90
      service: portfolio-app
      middlewares:
        - portfolio-rate-limit-global
        - portfolio-inflight-global
        - portfolio-body-limit-contact
        - portfolio-compress

    portfolio-web:
      entryPoints:
        - web
      rule: PathPrefix(`/`)
      priority: 1
      service: portfolio-app
      middlewares:
        - portfolio-rate-limit-global
        - portfolio-inflight-global
        - portfolio-body-limit-web
        - portfolio-compress

  middlewares:
    portfolio-compress:
      compress: {}

    portfolio-rate-limit-global:
      rateLimit:
        average: 60
        burst: 120
        period: 1m

    portfolio-analytics-rate-limit:
      rateLimit:
        average: 30
        burst: 30
        period: 1m

    portfolio-inflight-global:
      inFlightReq:
        amount: 200

    portfolio-body-limit-web:
      buffering:
        maxRequestBodyBytes: 1048576

    portfolio-body-limit-contact:
      buffering:
        maxRequestBodyBytes: 65536

    portfolio-body-limit-analytics:
      buffering:
        maxRequestBodyBytes: 262144

    portfolio-analytics-allow:
      ipAllowList:
        sourceRange:
          - 0.0.0.0/0
          - ::/0

  services:
    portfolio-app:
      loadBalancer:
        servers:
          - url: http://app:8000
